<html lang="en">
<head>
    <meta http-equiv="Content-Type"  content="text/html; charset=utf-8">
    <title>Lab2: Proof Engineering with Z3</title>
    <link rel="stylesheet" href="../labs.css" type="text/css">
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
          src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
</head>
<body>
<h1>Lab 2: Proof Engineering with Z3</h1>
<hr />

<h2>Overview</h2>
<p>
  In this lab, we'll study how to perform basic
  theorem proving with Z3 by finishing several exercises.
  These examples will cover basic logical connectives include implication,
  disjunction and conjunction. After finishing the examples, you'll do
  some proofs on your own, these problems will tagged with
  <samp>Exercise</samp>. There are some challenging problems which are
  tagged <i>Challenge</i>, which are optional.
  Download <a href="lab2-code.zip">this code template</a> to start with.
  For any problems, feel free to ask the TAs for help.
</p>

<p>
  Before starting with this lab, make sure you have finished
  <a href="../lab1/index.html">lab 1</a> and
  have Python and Z3 properly installed on your computer.
</p>


<h3>Hand-in Procedure</h3>
<p>
  When you finished the lab, zip you code files (exclude .venv and other temporary folder) 
  with file name <samp>&lt;ID&gt;-lab-2.zip</samp> (e.g., <samp>SA19225789-lab-2.zip</samp>),
  and submit it to <a href="https://bb.ustc.edu.cn/">USTC Online Teaching Platform</a>.
  The deadline is 23:59 of November 24th, 2023 (Beijing time).
  Any late submission will <b>NOT</b> be accepted.
</p>

<hr />

<h2>Part A: Z3 Basic</h2>
<p>
  In this section, let's start by learning how to do proof development
  with Z3. At each stage of a proof development, one has a list of goals
  to prove. Initially, the list consists of the theorem itself. After
  applying some tactics, the list of goals contains the sub-goals is
  generated by the tactics.
</p>

<p>The basic structure of Coq theorem:</p>
<table>
  <tr>
      <th>Expression</th>
      <th>Representation</th>
  </tr>
  <tr>
      <td>And</td>
      <td>/\</td>
  </tr>
  <tr>
      <td>Or</td>
      <td>\/</td>
  </tr>
  <tr>
      <td>Not</td>
      <td>¬</td>
  </tr>
  <tr>
      <td>Implies</td>
      <td>-&gt;</td>
  </tr>
</table>

<p>in which, some key points deserve further explanations:</p>

<ul>
    <li><samp>And(*args)</samp>     
      Create a Z3 and-expression;<br>
    <li><samp>Or(*args)</samp> Create a Z3 or-expression;</li>
    <li><samp>Not(a)</samp> Create a Z3 not expression;</li>
    <li><samp>Implies(a, b)</samp> Create a Z3 implies expression;</li>
</ul>

<p>
  In this section, we'll learn to use these Expression: <samp>And</samp>,
  <samp>Or</samp>, <samp>Not</samp>, <samp>Implies</samp>.
</p>

<h2><samp>And</samp>, <samp>Or</samp>, <samp>Not</samp>, <samp>Implies</samp></h2>
<p>
  Let's start with an example of And(*args).
</p>

<b>Example 1:</b>
<pre>
  P, Q, R = Bools('P Q R')
  And(P, Q, R)
</pre>

<p>
  Firstly, we need to declare <samp>P Q R</samp> as Bool type; <br>
  then, <samp>And(P, Q, R)</samp> means proposition : <samp>P /\ Q /\ R</samp>
</p>

<p>
  We continue to look at our next example of Or(*args):
</p>
<b>Example 2:</b>
<pre>
  >>> P, Q, R = Bools('P Q R')
  >>> Or(P, Q, R)
  Or(P, Q, R)
</pre>

<p>
  Firstly, we need to declare <samp>P Q R</samp> as Bool type; <br>
  then, <samp>Or(P, Q, R)</samp> means proposition : <samp>P \/ Q \/ R</samp>
</p>

<p>
  We continue to look at our next example of Not(a):
</p>

<b>Example 3:</b>
<pre>
  >>> P = Bools('P')
  >>> Not(P)
  Not(P)
</pre>

<p>
  Firstly, we need to declare <samp>P</samp> as Bool type; <br>
  then, <samp>Not(P)</samp> means proposition : <samp>¬P</samp>
</p>

<p>
  We continue to look at our next example of Implies(a, b):
</p>

<b>Example 4:</b>
<pre>
  >>> P, Q = Bools('P Q')
  >>> Implies(P, Q)
  Implies(P, Q)
</pre>

<p>
  Firstly, we need to declare <samp>P Q</samp> as Bool type; <br>
  then, <samp>Implies(P, Q)</samp> means proposition : <samp>P -> Q</samp>
</p>

<p>
    After learning the usage of these expression, you can try to 
    finish the following exercises.
</p>

<div class="question">
  <b>Exercise 1</b>: Try to define and prove the following propositional logic proposition:
   $$ P \to ( Q \to P) $$
</div>

<div class="question">
  <b>Exercise 2</b>: Try to define and prove the following propositional logic proposition:
  $$ (P \to Q) \to ((Q \to R) \to (P \to R)) $$
</div>

<div class="question">
  <b>Exercise 3:</b> Try to define and prove the following propositional logic proposition:
  $$ (P \wedge ( Q \wedge R )) \to ((P \wedge Q) \wedge R) $$
</div>

<div class="question">
  <b>Exercise 4:</b> Try to define and prove the following propositional logic proposition:
  $$ (P \vee (Q \vee R)) \to ((P \vee Q) \vee R)$$
</div>

<div class="question">
  <b>Exercise 5:</b> Try to define and prove the following propositional logic proposition:
  $$ ((P \to R) \wedge (Q \to R)) \to ((P \wedge Q) \to R) $$
</div>

<div class="question">
  <b>Exercise 6: </b> Try to define and prove the following propositional logic proposition:
  $$ ((P \wedge Q) \to R) \iff (P \to (Q \to R)) $$
</div>

<div class="question">
  <b>Exercise 7: </b> Try to define and prove the following propositional logic proposition:
  $$ (P \to Q) \to (\neg Q \to \neg P ) $$
</div>

<hr/>

<h2>Part B: Predicate Logic Proposition</h2>
<p>
  In this section, we'll learn how to prove predicate logic theorems using Z3.
  In Z3, we have two additional declarations for full quantifiers.
</p>

<p>The basic structure of Coq theorem:</p>
<table>
  <tr>
      <th>Expression</th>
      <th>Representation</th>
  </tr>
  <tr>
      <td>ForAll</td>
      <td>∀x.</td>
      </tr>
  <tr>
      <td>Exists</td>
      <td>∃x.</td>
  </tr>
</table>

<p>in which, some key points deserve further explanations:</p>

<ul>
    <li><samp>ForAll(vs, body)</samp> Create a Z3 forall formula;<br>
    <li><samp>Exists(vs, body)</samp> Create a Z3 exists formula.</li>
</ul>

<p>
  In this section, we'll learn to use these Expression: <samp>ForAll</samp>,
  <samp>Exists</samp>.
</p>

<h2><samp>ForAll</samp>, <samp>Exists</samp></h2>
<p>
  Let's start with an example of ForAll(vs, body).
</p>

<b>Example 5:</b>
<pre>
  isort = IntSort()
  bsort = BoolSort()
  
  x = Int('x')
  P = Function('P', isort, bsort)
  ForAll(x, P(x))
  ForAll(x, P(x))
</pre>

<p>  
  In Z3, sort refers to the type of data or mathematical structure;
  <br>
  Here, IntSort() represents integer sort, BoolSort() represents 
  Boolean sort;<br>
  Then an Int variable named 'x' was declared;<br>
  Then a function (or predicate) P was declared, with an input of 
  integer type (isort) and an output of Boolean type (bsort)<br>
  Finally, we declare the proposition : <samp>ForAll(x, P(x))</samp> means proposition : <samp> ∀x.P(x)</samp>
</p>

<p>
  We continue to look at our next example of Exists(vs, body):
</p>


<b>Example 6:</b>
<pre>
  isort = IntSort()
  bsort = BoolSort()
  
  x = Int('x')
  P = Function('P', isort, bsort)
  Exists(x, P(x))
  Exists(x, P(x))
</pre>

<p>
  Obviously, we declare the proposition :
  <samp>Exists(x, P(x))</samp> means proposition : <samp> ∃x.P(x)</samp>
</p>

<p>
  After learning the usage of these expression, you can try to 
  finish the following exercises.
</p>

<div class="question">
  <b>Exercise 8:</b>
  Try to define and prove the following predicate logic proposition:
  $$\forall x. (\neg p(x) \wedge Q(x)) \to \forall x. (P(x) \to Q(x)) $$
</div>

<div class="question">
  <b>Exercise 9:</b>
      Try to define and prove the following predicate logic proposition:
    $$\forall x. (P(x) \wedge Q(x)) \iff (\forall x. P(x) \wedge \forall x.Q(x)) $$
</div>

<div class="question">
  <b>Exercise 10:</b>
  Try to define and prove the following predicate logic proposition:
  $$ \exists x. (\neg P(x) \vee Q(x)) \to \exists x. (\neg (P(x) \wedge \neg Q(x))) $$
</div>

<div class="question">
  <b>Exercise 11:</b>
      Try to define and prove the following predicate logic proposition:
      $$\exists x. (P(x) \vee Q(x)) \iff (\exists x. P(x) \vee \exists x. Q(x))$$
</div>

<div class="question">
  <b>Exercise 12:</b>
  Try to define and prove the following predicate logic proposition:
  $$ \forall x. (P(x) \to \neg Q(x)) \to \neg (\exists x. (P(x) \wedge Q(x)))$$
</div>

<div class="question">
  <b>Exercise 13:</b>
  Try to define and prove the following predicate logic proposition:
  $$ \exists x. (P(x) \wedge Q(x)) \wedge \forall x. (P(x) \to R(x)) \to \exists (R(x) \wedge Q(x))$$
</div>

<div class="question">
  <b>Exercise 14:</b>
  Try to define and prove the following predicate logic proposition:
  $$ \exists x. \exists y. P(x, y) \to \exists y. \exists x. P(x, y) $$
</div>

<div class="question">
  <b>Exercise 15:</b>
  Try to define and prove the following predicate logic proposition:
  $$ P(b) \wedge (\forall x. \forall y. (P(x) \wedge P(y) \to x = y )) \to (\forall x. (P(x) \iff x = b )) $$
</div>

<hr />

<h2>Part C: Deduction System</h2>
<p>
    In this section, we need to define some rules to prove the
    logical theorem.
</p>

<div class="challenge">
  <i>Challenge:</i>
  We provide the following two rules :
  <pre>
    ----------------(odd_1)
          odd 1

          odd n
    ----------------(odd_ss)
        odd n + 2
  </pre>
  Please encode these rules using Z3, then prove that integers
    9, 25, and 99 are odd numbers.
</div>


<br>
<hr>
<p>
  After finished the lab, don't forget zip you code files
  with file name <samp>&lt;ID&gt;-lab-2.zip</samp> (e.g.,
  <samp>SA19225789-lab-2.zip</samp>), and submit it to
  <a href="https://bb.ustc.edu.cn/">USTC Online Teaching Platform</a>.
</p>
<p>
    Happy hacking!
</p>
</body>

</html>
<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Lab 0: Software Setup</title>
    <link rel="stylesheet" href="../labs.css" type="text/css">
</head>

<body>

<h1>Lab 0: Software Setup</h1>

<hr>

<h2>Overview</h2>
<p>
    In this lab, you will install and set up the software
    used in this course, including virtual machines, operating
    systems, compilers, debuggers, IDEs, among others.
    As some labs (e.g., network sniffing) is dangerous and may
    bring serious consequences, so you should finish these
    labs in virtual machines, but NOT in your
    local machines.
</p>

<h3>Hand-in Procedure</h3>
<p>
    After finishing the assignment, you should zip your code
    files with the file
    name <samp>student ID-lab-&lt;n&gt;.zip</samp>
    (e.g., <samp>SA19225789-lab-0.zip</samp>)
    and submit it to the
    <a href="http://yjs.ustc.edu.cn/">Postgraduate Information Platform</a>.
</p>

<p>
    You do NOT need to submit anything for this lab.
</p>

<hr>
<h2>Part A: Installing Linux</h2>
<p>
    All labs in this course must be finished using a
    Linux system, and we will be using Ubuntu for our lab.
    In this part, you should install Linux first, if you have not.
</p>

<h3>1: Windows</h3>
<p>
    Please follow these steps to set up the Windows Subsystem
    for Linux (WSL):
</p>

<p>
    1. Create a new text file <samp>run.bat</samp> (Windows script file)
    at any location and paste
    the following content into it:
</p>
<div>
        <pre>
pushd "%~dp0"
dir /b %SystemRoot%\servicing\Packages\*Hyper-V*.mum > hyper-v.txt
for /f %%i in ('findstr /i . hyper-v.txt 2^>nul') do dism /online /norestart
/add-package:"%SystemRoot%\servicing\Packages\%%i"
del hyper-v.txt
Dism /online /enable-feature /featurename:Microsoft-Hyper-V -All /LimitAccess /ALL
pause
    </pre>
</div>
<p>
    Save the file then right-click it, and run it with the administrator
    privilege. Then, reboot your computer.
</p>

<p>
    2. After your computer rebooted, open Windows Features
    (Press <code>Win+R</code> and enter <samp>optionalfeatures.exe</samp>):
    <br/><img src="imgs/lab0-1.png" alt="" width="400"><br/>

    Enable the following three options: Hyper-V, Windows Subsystem
    for Linux, and Virtual Machine Platform:
    <br/><img src="imgs/lab0-2.png" alt="" width="400">
    <br/><img src="imgs/lab0-3.png" alt="" width="400">
</p>

<p>
    3. Run PowerShell with an administrator privilege, then run the command
    to update WSL:
</p>
<div>
    <kbd>
        $ wsl --update
    </kbd>
</div>

<p>
    4. If you want to learn more about WSL, please refer to the
    <a href="https://learn.microsoft.com/en-us/windows/wsl/">
        Microsoft Official Documentation</a>.
</p>


<h3>2: Mac (x86) or Linux</h3>
<p>
    Download and install <a href="https://multipass.run/install">
    Multipass</a> with the following steps:
</p>
<p>
    1. Install multipass using brew:
</p>
<div>
    <kbd>
        $ brew install --cask multipass
    </kbd>
</div>

<p>
    2. Create and launch Ubuntu:
</p>
<div>
    <kbd>
        $ multipass launch --cpus 4 --disk 10G --mem 4G --name ubuntu
    </kbd>
</div>
<p>
    Play attention to the <samp>Name</samp> and <samp>IPv4</samp> values
    for the newly created Ubuntu. You'll need them to connect to the
    virtual machine using VSCode.
</p>
<p>3. Access Ubuntu:</p>
<div>
    <kbd>
        $ multipass shell ubuntu
    </kbd>
</div>

<p>
    4. For accessing the container, you need to add the Mac's
    public key to the virtual machine first. On your Mac,
    use the following command to retrieve the public key:
</p>
<div>
    <kbd>
        $ cat .ssh/id_rsa.pub
    </kbd>
</div>

<p>If it doesn't exist, create one using:</p>

<div>
    <kbd>
        $ ssh-keygen -t rsa
    </kbd>
</div>

<p>
    Then, just press "Enter" for all the subsequent prompts.
    Use the <kbd>cat</kbd> command to view the Mac's public key:
</p>
<div>
    <kbd>
        $ cat .ssh/id_rsa.pub
    </kbd>
</div>

<p>
    Copy the output and paste it into the virtual machine's
    <samp>~/.ssh/authorized_keys</samp> file.
</p>

<p>
    To remotely connect using VSCode, enter:
</p>

<div>
    <kbd>
        $ ssh ubuntu@192.168.64.2 -A
    </kbd>
</div>
After this step, you should successfully connect to the VM and use it.

<br/>

<h3>3: Mac (M1/M2/M3)</h3>
<p>
    You may want to try <a href="https://mac.getutm.app/">UTM</a>.
</p>

<hr/>
<h2>Part B: Install Software</h2>
<h3>
    1 Install Ubuntu
</h3>

<p>
    To install Ubuntu in Windows WSL, open the WSL terminal
    and enter the command:
</p>
<div>
    <kbd>
        $ wsl --list --online <br/>
    </kbd>
</div>
which will list candidates OS images that you can install:

<br/> <img src="imgs/listonline.png" width="600" alt="">

<p>
    (2) We will be using Ubuntu-22.04 in this course, so
    enter the command following in the terminal:
</p>
<div>
    <kbd>
        $ wsl --install Ubuntu-22.04
    </kbd>
</div>
<p>
    (3) Set a name and password:
    <br/> <img src="imgs/Ubuntuhello.png" width="600" alt="">
</p>

<p>
    For Mac, run the
    <a href="https://multipass.run/install">Multipass commands</a>,
    to install Ubuntu-22.04:
</p>
<div>
    <kbd>
        $ multipass find
    </kbd>
</div>


<h3>
    2. Install GCC
</h3>
<p>
    GCC is a free compiler from the GNU project, and has been
    adopted as a standard
    compiler by most Unix-like operating systems
    (such as Linux, BSD, etc.). For more
    detailed information
    about GCC, you can refer to its
    <a href="https://gcc.gnu.org/onlinedocs/">official
        documentation</a>.
</p>
<p>
    (1)Install the GCC compiler:
</p>
<div>
    <kbd>
        $ sudo apt-get install gcc
    </kbd>
</div>

<p>
    (2) To double-check the installation is successful:
</p>
<div>
    <kbd>
        $ gcc --version
    </kbd>
</div>

<b>Quick start</b>
<p>
    Prepare the following <samp>hello.c</samp> program:
</p>
<pre>
    #include &lt;stdio.h&gt;
    void print(){
        printf("hello, world!\n");
    }

    int main(){
        print();
        return 0;
    }
</pre>
<p>
    (2) compile this program to an executable:
</p>
<div>
    <kbd>
        $ gcc hello.c -o hello.out
    </kbd>
</div>
Run the generated executable:
<div>
    <kbd>
        $ ./hello.out
    </kbd>
</div>

<br/>
<h3>
    3. Install GDB
</h3>
<p>
    GDB is a widely-used debugger on UNIX and UNIX-like systems. By using GDB,
    you can debug your programs to inspect
    program and data such as variables, registers,
    and memory status.
    For more information of GDB, you can refer to
    its <a href="https://www.gnu.org/software/gdb/documentation/">
    official documentation</a>.
</p>
<b>
    Install GDB
</b>
<p>
    (1) Run the following command to install
    the GDB debugging tool:
</p>
<div>
    <kbd>
        $ sudo apt-get install gdb
    </kbd>
</div>
<p>
    (2) To double-check your installation successful:
<div>
    <kbd>
        $ gdb --version
    </kbd>
</div>

<b>Quick start</b>
<p>
    To demonstrate the usage of gdb, let us debug the
    executable <samp>hello.out</samp> we just compiled with gcc:
</p>
<div>
    <kbd>
        $ gdb hello.out
    </kbd>
</div>
which will start the gdb.
<p>
    We can set up a break point using the <kbd>b</kbd> command.
    For example, to set up break point on the function
    <samp>print()</samp>:
</p>
<div>
    <kbd>
        $ b print
    </kbd>
</div>

<p>
    The GDB command <kbd>r</kbd> will execute program being debugged.
    And the program being debugged will stop when hitting the
    breaking points:
</p>
<img src="imgs/image-20210921193009287.png" width="400" alt="">
<p>
    The command <kbd>c</kbd> will resume the program.
    Enter the command <kbd>q</kbd> to exit GDB.
</p>


<h3>4. make</h3>
<p>
    Make is a cross-platform building tool.
    For more detailed information of make, you can refer to
    its <a href="https://cmake.org/documentation/">
    official documentation</a>.
</p>
<b>
    Install make
</b>
<div>
    <kbd>
        $ sudo apt install make
    </kbd>
</div>
and follow the prompts to install make. Make sure your
installation of make is successful:
<div>
    <kbd>
        $ make --version
    </kbd>
</div>

<h3>1.5 VSCode</h3>
<p>
    Visit the official website of <a href="https://code.visualstudio.com/">
    VSCode</a>, download and install VS code. (The following
    figure depicts the installation for Windows, whereas the installation
    for other platforms are similar.)
    <br/><img src="imgs/installvscode.png" width="691" alt="">
</p>

<b>Run VSCode</b>
<p>
    Enter the command following in the wsl terminal,
    you can open VSCode:
</p>

<div>
    <kbd>
        $ code .
    </kbd>
</div>
<br/><img src="imgs/code.png" width="691" alt="">

<h3>1.6 CLion</h3>
<p>
    CLion is another cross-platform IDE (Integrated
    development environment) designed for C/C++.
    It contains many
    intelligent features (e.g., error prompts,
    code completion, automatic generation of make
    files),
    which improve developer productivity.
</p>
<b>
    Install CLion
</b>
<p>
    Download and install Clion first. As CLion is a paid software,
    then go to the <a href="https://account.jetbrains.com/login">
    official website of CLion</a> and use your USTC email to register
    an account.
</p>


<br>
<hr>
This completes this lab. You do NOT need to submit anything for this lab.
<!--
Remember to zip your code with the file
name <samp>student ID-lab-&lt;N&gt;.zip</samp>
(e.g., <samp>SA19225789-lab-0.zip</samp>), and
submit it to the <a href="http://yjs.ustc.edu.cn/">
    Postgraduate Information Platform</a>.
-->

<p>
    Happy hacking!
</p>

<br>
<br>


</body>

</html>